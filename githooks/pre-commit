#!/usr/bin/env python3
"""Git pre-commit hook to ensure the test suite passes before committing."""

from __future__ import annotations

import subprocess
import sys
from pathlib import Path

PROJECT_ROOT = Path(__file__).resolve().parent.parent


def run_pytest() -> int:
    """Execute pytest in the project root and return the exit code."""

    cmd = [sys.executable, "-m", "pytest"]
    print("pre-commit: running", " ".join(cmd))
    result = subprocess.run(cmd, cwd=PROJECT_ROOT)
    return result.returncode


def main() -> int:
    exit_code = run_pytest()
    if exit_code != 0:
        print("pre-commit: tests failed, aborting commit.")
    else:
        print("pre-commit: all tests passed.")
    return exit_code


if __name__ == "__main__":
    sys.exit(main())
